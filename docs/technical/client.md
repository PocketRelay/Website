---
sidebar_position: 2
---

# Client


## Official servers

The official servers are structured very differently than Pocket Relay as they have many distributed servers bound to many different ports. 

Keeping all this logic on the server-side can make the server difficulty to host due to all of the different ports and protocols.

To counterract this Pocket Relay moves the handling and binding for all these ports over to the client-side instead opting for proxying all the traffic through improved/more secure protocols.

An example of this is the game is still stuck using the SSLv3 protocol which is very un-supported by most of the internet these days. The client combats this my locally handling the SSLv3 connections using the [blaze-ssl-async](https://github.com/jacobtread/blaze-ssl-async) library that was created for this purpose and then the client proxies the connection over TLSv3 using [Connection Upgrading](#connection-upgrading).


## Connection Upgrading

In order to support the two-way communication that the BlazeSDK uses to communicate between the main server and the clients, without requiring binding a seperate port for the main server and HTTP server, The server and client make use of [HTTP Upgrades](https://www.rfc-editor.org/rfc/rfc9110#field.upgrade) in order to upgrade an HTTP connection.

Rather than having a seperate server upgrading connections over HTTP to client streams allows the server to operate seemlessly over a single port, allows the server to be placed behind a reverse proxy which enables security through TLS, and prevents the server from needing to implement any extra SSL protocol logic.

The initial stages of this can be seen in my blog post of the migration to this new structure https://jacobtread.com/blog/pocket-relay-http/

## Bink patch

The `binkw32.dll` patch is a DLL that replaces the normal `binkw32.dll` of the game with a modified DLL that hooks into certain functionality of the game to do things like disabling DLC checking, enabling the in-game console, and disabling certificate verification. This DLL also proxies the original DLL functions to the original DLL which is usually renamed to something like `binkw23.dll` or `binkw32-old.dll`

Pocket Relay uses this patch in order to disable the certificate verification of the game which allows the game to use the servers self-signed SSL certificate which the game would normally reject

The patch included in the current Pocket Relay Client comes from https://github.com/Erik-JS/masseffect-binkw32 

## Proxing

Documentation unfinished

## Hosts file

:::info
This section is why the client requires administrative permissions to run because the
systems host file is a protected file
:::

The normal client implementation makes use of the Windows system [Hosts file](https://en.wikipedia.org/wiki/Hosts_(file)) in order to tell Mass Effect 3 to talk to the local client instead of the remote servers.

It does this by pointing the `gosredirector.ea.com` address to `127.0.0.1` (Localhost) rather than its actual address.

:::tip Experimental Version
There is an experimental version of the client named _Plugin Client_ which doesn't require admin privilleges you can view the documentation for it [Here](../client/plugin-client) this works by rather than modifying the hosts file it instead directly hooks into the games host resolution function through an ASI plugin
:::

## Components

Documentation unfinished

### Redirector

The Redirector server is a server which is usually hosted at `gosredirector.ea.com` (there is other similar servers for different games such as `winter15.gosredirector.ea.com` and `summer15.gosredirector.ea.com` for Mass Effect Andromeda) and this server is responsible for telling game clients the public address of the [Main](#main) server.

:::note
All packets mentioned below are in the human-readable format generated by my Tdf library, the actual
packets are encoded with the binary TDF format
:::

Clients request the main server instance information from this server using a packet like the below:

```yaml
Official: Send
Request (0): Redirector->GetServerInstance (0x0005->0x0001)
Content: {
  "BSDK": "3.15.6.0",             # Version of BlazeSDK this client is using 
  "BTIM": "Dec 21 2012 12:47:10", # Possible the time this build was created or the BlazeSDK build time
  "CLNT": "MassEffect3-pc",       # The type of client connecting
  "CLTP": 0,
  "CSKU": "134845",
  "CVER": "05427.124",         # Appears to be client version
  "DSDK": "8.14.7.1",          # Client DirtySDK version
  "ENV": "prod",               # Client build environment 
  "FPID": Union(Unset),
  "LOC": 1701727834,           # Some kind of country identifier
  "NAME": "masseffect-3-pc",   # The game is Mass Effect 3 PC
  "PLAT": "Windows",           # The game is running on Windows
  "PROF": "standardSecure_v3", # Client is using the SSLv3 protocol
}
```

The redirector server then repsonds with:

```yaml
Official: Receive
Response (0): Redirector->GetServerInstance (0x0005->0x0001)
Content: {
  "ADDR": Union("VALU", 0, {
      "HOST": "gsprodblapp-02.ea.com", # The host address of the main server
      "IP": 2677623048,                # The ip address of the main server
      "PORT": 10019,                   # The port of the main server
    }),
  "SECU": 1,                           # Whether the main server is using SSLv3
  "TSVN": "",
  "XDNS": 0,
}
```

This message tells the client the credentials for the main server which it then closes the connection to the redirector and
connects to the main server

### Main

### QOS

With the official server there is not one but instead many different QOS servers in different regions. These servers are used both to measure connection speeds to different regions but also to determine the public address for clients so that clients can connect to eachother.

### Telemetry

The official server has telemetry servers that recieve client telemetry messages from the Mass Effect 3 game there are messages for all sorts of things like Killing Enemies, Viewing specific menus, Unlocking challenges, Changing Characters, Client loaded DLC, etc. 

For **Pocket Relay** this special message format is handled locally and then forwarded-on to the server over an HTTP endpoint

### HTTP